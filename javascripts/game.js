Crafty.init(800, 400, document.getElementById('game'));
Crafty.background('rgb(30,120,150)');


//Init Variables
var viewWidth = Crafty.viewport.width;
var viewHeight = Crafty.viewport.height;
var aiSpeed = 2;
var reward = 0;


//Paddles
var ai = Crafty.e('AIPaddle, 2D, Canvas, Color, Twoway')
  .attr({ x: 20, y: 300, w: 10, h: 100, powerup: "", name: "enemy" })
  .color('rgb(205, 200, 177)')
  .bind('EnterFrame', function () {
    if (this.y + (this.h / 2) < ball.y) {
      this.y += aiSpeed;
    } else {
      this.y -= aiSpeed;
    }

    if (this.y < 0) {
      this.y = 0;
    }
    if (this.y > viewHeight - this.h) {
      this.y = viewHeight - this.h;
    }
    if (this.powerup != "") {
      if (this.powerup == "enhancement_pill") {
        ai.h = 130;
        removePowerUpFrom(ai, "AIPowerUp");
        Crafty.e("Delay").delay(function () {
          ai.h = 100;
        }, 5000, 0);
      }
      else if (this.powerup == "ice_shower") {
        removePowerUpFrom(ai, "AIPowerUp");
        Crafty.e('2D, DOM, Image, Collision')
          .image("./icons/ice.png")
          .attr({
            x: 30, y: ai.y + (ai.h / 2), w: 20, h: 20,
            dX: +4, dY: 0
          })
          .onHit('PlayerPaddle', function () {
            player.h -= 20;
            Crafty.e("Delay").delay(function () {
              player.h += 20;
            }, 5000, 0);
            this.destroy();
          })
          .bind('EnterFrame', function () {
            this.x += this.dX;
            if (this.x < -20) {
              this.destroy();
            }
          })
      }
    }
  });

var player = Crafty.e('PlayerPaddle, 2D, Canvas, Color, Fourway')
  .attr({ x: (viewWidth - 30), y: 300, w: 10, h: 100, powerup: "", hitWall: 0, name: "player" })
  .color('rgb(205, 155, 155)')
  .fourway(4)
  .bind('EnterFrame', function () {
    this.x = viewWidth - 30;
    this.hitWall = 0;
    if (this.y < 0) {
      this.y = 0;
      this.hitWall = 1;
    }
    if (this.y > viewHeight - this.h) {
      this.y = viewHeight - this.h;
      this.hitWall = 1;
    }
  }).bind('KeyDown', function (e) {
    if (e.key == Crafty.keys.SPACE) {

      // Code to activate Power up
      if (this.powerup != "") {
        if (this.powerup == "enhancement_pill") {
          player.h = 130;
          removePowerUpFrom(player, "PlayerPowerUp");
          Crafty.e("Delay").delay(function () {
            player.h = 100;
          }, 5000, 0);
        }
        else if (this.powerup == "ice_shower") {
          removePowerUpFrom(player, "PlayerPowerUp");
          Crafty.e('2D, DOM, Image, Collision')
            .image("./icons/ice.png")
            .attr({
              x: (viewWidth - 30), y: player.y + (player.h / 2), w: 20, h: 20,
              dX: -4, dY: 0
            })
            .onHit('AIPaddle', function () {
              ai.h -= 20;
              Crafty.e("Delay").delay(function () {
                ai.h += 20;
              }, 5000, 0);
              this.destroy();
            })
            .bind('EnterFrame', function () {
              this.x += this.dX;
              if (this.x < -20) {
                this.destroy();
              }
            })
        }
      }
    }
  });;






// create an environment object
var env = {};
/*// List of states
-ball.x
-ball.y
-mypaddle.y
-enemy.y
-hitwall?
*/
env.getNumStates = function () { return 5; }
env.getMaxNumActions = function () { return 2; }

var actions = [1, 2];



// create the DQN agent
var spec = { alpha: 0.01 } // see full options on DQN page
agent = new RL.DQNAgent(env, spec);

document.getElementById("saveData").addEventListener("click", function () {
  localStorage.agentBrain =  JSON.stringify(agent.toJSON());
  try{
    var temp = JSON.parse(localStorage.agentBrain);
    console.log("Data saved sucessfully.... Most likely...");
  }catch(e){
    console.log("ERROR while saving data!! Try again in a while!");
  }
});

document.getElementById("loadData").addEventListener("click", function () {
  console.log("Load Data");
  
  try {
    var agentBrain = JSON.parse(localStorage.agentBrain);  
  } catch (error) {
    console.log("Couldn't find a brain in localStorage so loading the one from file");
    var agentBrain = savedBrain;
  }
  console.log(agentBrain);
  agent.fromJSON(agentBrain);
});



Crafty.e("Delay").delay(function () {
  localStorage.agentBrain =  JSON.stringify(agent.toJSON());
console.log("Saved Brain through CRON");
}, 1200000, -1);



//Ball
var ball = Crafty.e('2D, DOM, Image, Collision')
  .image("./icons/ball.png")
  .attr({
    x: viewWidth / 2, y: viewHeight / 2, w: 10, h: 10,
    dX: Crafty.math.randomInt(2, 5),
    dY: Crafty.math.randomInt(2, 5),
    name: "ball"
  })
  .bind('EnterFrame', function () {

    //hit floor or roof
    if (this.y <= 0 || this.y >= viewHeight - this.h){
      this.dY *= -1;
    }
    if (this.x > viewWidth - this.w) {
      this.x = viewWidth / 2;
      this.y = (viewHeight / 2) - (this.h / 2);
      this.dY =  Crafty.math.randomInt(-3, 3);
	if(this.dY == 0){
	this.dY = 1;}
      this.dX = Crafty.math.randomInt(2, 3);
      Crafty('AIPoints').each(function () {
        this.text(++this.points + ' Points')
      });
    }
    if (this.x < this.w) {
      this.x = viewWidth / 2;
      this.y = (viewHeight / 2) - (this.h / 2);
      this.dX = Crafty.math.randomInt(-2, -3);
      this.dY =  Crafty.math.randomInt(-3, 3);
	if(this.dY == 0){
	this.dY = 1;}      
Crafty('PlayerPoints').each(function () {
        this.text(++this.points + ' Points')
      });
      //aiSpeed += 0.3;
      Crafty('AISpeed').each(function () {
        this.text("AI Speed: " + aiSpeed)
      });
    }


    this.x += this.dX;
    this.y += this.dY;





    var action = agent.act(getState());
    var actionString = "";
    if (action == 0) {
      ++player.y;
	actionString = "Down";
    }
    if (action == 1) {
      --player.y;
	actionString = "Up";
    }

    reward = 0;
    //Reward calculation
    var objectsHit = this.hit("PlayerPaddle");
    if (objectsHit != false) {
      reward += 1.0;
    }

    if (this.x < this.w) {
      reward += 100.0;
    }

    if (this.x > viewWidth - this.w) {
      reward -= 100.0;
    }

	Crafty('PlayerPowerUp').each(function () {
    this.text("Reward: " + reward);
  });

	Crafty('FPSCounter').each(function () {
    this.text("Agent Action: " + actionString);
  });



    agent.learn(reward);
	



  })
  .onHit('PlayerPaddle', function () {
    this.dX *= -1;
    this.dY += getYReflection(player);
    createPowerUpFor(ai, 'AIPaddle');
  })
  .onHit('AIPaddle', function () {
    //aiSpeed -= 0.1;
    Crafty('AISpeed').each(function () {
      this.text("AI Speed: " + aiSpeed)
    });
    this.dY += getYReflection(ai);
    this.dX *= -1;
    createPowerUpFor(player, 'PlayerPaddle');
  })






/*
setInterval(function(){ // start the learning loop
  var action = agent.act(s); // s is an array of length 8
  //... execute action in environment and get the reward
  agent.learn(reward); // the agent improves its Q,policy,model, etc. reward is a float
}, 0);
*/
function getState() {
  var state = [];
  state.push(ball.x);
  state.push(ball.y);
  state.push(player.y);
  state.push(ai.y);
  state.push(player.hitWall);
  return state;
}


// Function to calculate the reflection angle of ball after it hits the paddle
function getYReflection(paddle){

  var middleOfBall = ball.y + ball.h/2;
  var middleOfPaddle = paddle.y + paddle.h/2;
  var distance = middleOfPaddle - middleOfBall;
  var dY = (distance * 1.5) / (paddle.h / 2);
  dY *= -1; 
  return dY;
}


















//Score boards
Crafty.e('AIPoints, DOM, 2D, Text')
  .attr({ x: 20, y: 20, w: 100, h: 20, points: 0 })
  .textColor('#FFFFFF', 0.8)
  .text('0 Points');
Crafty.e('PlayerPoints, DOM, 2D, Text')
  .attr({ x: 715, y: 20, w: 100, h: 20, points: 0 })
  .textColor('#FFFFFF', 0.8)
  .text('0 Points');


// PowerUp board
Crafty.e('AIPowerUp, DOM, 2D, Text')
  .attr({ x: 20, y: 40, w: 100, h: 20 })
  .textColor('#FFFFFF', 0.8)
  .text('Power Up : None');
Crafty.e('PlayerPowerUp, DOM, 2D, Text')
  .attr({ x: 700, y: 40, w: 100, h: 20 })
  .textColor('#FFFFFF', 0.8)
  .text('Power Up : None');


// AI Speed board
Crafty.e('AISpeed, DOM, 2D, Text')
  .attr({ x: 20, y: 60, w: 200, h: 20 })
  .textColor('#FFFFFF', 0.8)
  .text('AI Speed: ' + aiSpeed);



// FPS Counter
Crafty.e('FPSCounter, DOM, 2D, Text')
  .attr({ x: 700, y: 60, w: 100, h: 20 })
  .textColor('#FFFFFF', 0.8)
  .text('FPS: 0');


function createPowerUpFor(item, paddleName) {
  var yourFate = Crafty.math.randomInt(0, 100);
  if (yourFate > 190) {
    // Create a power Usp
    var whichPowerUp = Crafty.math.randomInt(1, 2);
    if (whichPowerUp == 1) {
      var enhancementPill = Crafty.e('2D, DOM, Image, Collision')
        .image("./icons/expand.png")
        .attr({
          x: item.x, y: Crafty.math.randomInt(0, (viewHeight - 10)), w: 20, h: 20,
        })
        .onHit(paddleName, function () {
          givePowerUpTo(paddleName, "enhancement_pill");
          enhancementPill.destroy();
        })
      Crafty.e("Delay").delay(function () {
        enhancementPill.destroy();
      }, 3000, 0);
    }
    else if (whichPowerUp == 2) {
      var coldShower = Crafty.e('2D, DOM, Image, Collision')
        .image("./icons/ice.png")
        .attr({
          x: item.x, y: Crafty.math.randomInt(0, (viewHeight - 10)), w: 20, h: 20,
        })
        .onHit(paddleName, function () {
          givePowerUpTo(paddleName, "ice_shower");
          coldShower.destroy();
        });
      Crafty.e("Delay").delay(function () {
        coldShower.destroy();
      }, 3000, 0);
    }
  }
}



function givePowerUpTo(name, powerUp) {
  var paddle;
  var powerUpBoard = "";
  if (name == "PlayerPaddle") {
    paddle = player;
    powerUpBoard = "PlayerPowerUp";
  } else {
    paddle = ai;
    powerUpBoard = "AIPowerUp";
  }
  paddle.powerup = powerUp;
  Crafty(powerUpBoard).each(function () {
    this.text("Power Up: " + powerUp);
  })
}


function removePowerUpFrom(item, powerUpBoard) {
  item.powerup = "";
  Crafty(powerUpBoard).each(function () {
    this.text('Power Up: None');
  });
}



// Saving Brain after ~30 hours of trianing
var savedBrain = {
  "nh": 100,
  "ns": 5,
  "na": 2,
  "net": {
    "W1": {
      "n": 100,
      "d": 5,
      "w": {
        "0": 0.11030596753389395,
        "1": 0.006289031378237736,
        "2": 0.03925966618315479,
        "3": 0.04463628827201412,
        "4": 0.006530906889996554,
        "5": -0.055550132035274334,
        "6": -0.3835748926960579,
        "7": -0.12551061838620337,
        "8": -0.289642421270975,
        "9": -0.0014225309574723123,
        "10": -0.0645156382178734,
        "11": -0.21877300701520644,
        "12": -0.05583363510425652,
        "13": -0.16146842533244862,
        "14": 0.003182599507380711,
        "15": 0.06900770237937427,
        "16": 0.44040010377506655,
        "17": 2.7751077633249515,
        "18": 0.8449277960096334,
        "19": -0.013313533696973495,
        "20": 0.3090920881881534,
        "21": 0.720149722059207,
        "22": -0.01632656799934245,
        "23": 0.5728378450868218,
        "24": 0.013743858978991424,
        "25": -0.141738221149261,
        "26": -0.02081555267508562,
        "27": -0.04223954672721448,
        "28": -0.037823156685868234,
        "29": 0.005624474596967342,
        "30": -0.2548886078394191,
        "31": -0.10596423630272722,
        "32": -0.17194996655154374,
        "33": -0.08832333740495218,
        "34": 0.01950510365080928,
        "35": -0.036297104023822364,
        "36": -0.09609220816205677,
        "37": -0.2381826304565041,
        "38": -0.18836668781497987,
        "39": 0.006127891275206151,
        "40": 0.413995151303415,
        "41": 0.4530290980226272,
        "42": -1.7967260764888386,
        "43": 0.764603209661153,
        "44": 0.0002466962028286085,
        "45": -0.14207751471894567,
        "46": -0.06459955116977023,
        "47": -0.11864100074396075,
        "48": -0.047487255302885216,
        "49": 0.013085763935777461,
        "50": 0.8582353745672308,
        "51": 0.2597369264279907,
        "52": 0.8772236452395461,
        "53": -0.06950723325787096,
        "54": 0.0000720107264381014,
        "55": -0.3273375836849971,
        "56": 0.00037716025555151054,
        "57": -0.11638065435008156,
        "58": -0.024319893540827035,
        "59": -0.014236675257680844,
        "60": -0.2701316360349619,
        "61": -1.117816255694941,
        "62": -0.2457427923917654,
        "63": -0.5067318629895358,
        "64": 0.01034005710865816,
        "65": 0.7578828875309082,
        "66": 0.4901813991193031,
        "67": 0.3163076677552237,
        "68": -0.029275433664331503,
        "69": -0.009807393096374508,
        "70": -0.1907607198380849,
        "71": -0.250627572298985,
        "72": 0.010886505900696135,
        "73": -0.19848433835638657,
        "74": -0.013443226341539277,
        "75": -0.32547965991943967,
        "76": -0.7813735756468361,
        "77": -0.1324385722669085,
        "78": -0.26013830741682614,
        "79": 0.007441023570833543,
        "80": -0.08196930544692677,
        "81": -0.07501002932227836,
        "82": -0.045093777400780334,
        "83": -0.07133463883689183,
        "84": -0.010135174116524695,
        "85": 0.1347459406629716,
        "86": 0.0352284003364969,
        "87": 0.022624561227397477,
        "88": 0.0390398961670795,
        "89": 0.010466853902656989,
        "90": -0.05031433888160492,
        "91": -0.06111046015353313,
        "92": -0.24453266669291915,
        "93": -0.08134107087243223,
        "94": 0.000908182213285033,
        "95": 0.15251897199854536,
        "96": 0.03556503053362619,
        "97": 0.03242895803976616,
        "98": 0.03249920887173586,
        "99": -0.0012944485767801394,
        "100": -0.05013545988902145,
        "101": -0.05674568797267188,
        "102": -0.04647487738649897,
        "103": -0.05934417527848586,
        "104": -0.006975032458349957,
        "105": -0.23617044630515116,
        "106": -0.0537676400731993,
        "107": 0.00004671727858804746,
        "108": -0.06342317870828701,
        "109": 0.007075577904235148,
        "110": 0.22475441533514973,
        "111": -0.046774391826185494,
        "112": 0.09996321969923506,
        "113": 0.7163209714905461,
        "114": -0.005119138743480666,
        "115": 0.05166451146320616,
        "116": 0.25111373457227654,
        "117": 0.11136147586724192,
        "118": 0.21765967163841987,
        "119": 0.0017462351575279415,
        "120": -0.33779686788873936,
        "121": -0.37568180882741625,
        "122": -0.13251299658815796,
        "123": -0.006593743993320312,
        "124": -0.016163001064772843,
        "125": -2.4210704542397106,
        "126": 9.215609282145161,
        "127": -4.828071733463373,
        "128": 0.29735959824313696,
        "129": 0.0024568166825222996,
        "130": -0.05237490326663424,
        "131": -0.11843123687534572,
        "132": -0.32132072551241847,
        "133": -0.08774104752232811,
        "134": -0.0063963627556975705,
        "135": -0.1530271988550864,
        "136": 0.000563904486034149,
        "137": -0.009893738967994859,
        "138": -0.036800472933649755,
        "139": 0.011199465830610949,
        "140": 0.0899055181253148,
        "141": 0.6413797328899394,
        "142": 0.45180989272173805,
        "143": 0.5459156096639761,
        "144": -0.01592919064922101,
        "145": -0.07177647541121562,
        "146": -0.005966448441434129,
        "147": -0.2372920649806806,
        "148": -0.16415952225221309,
        "149": 0.014820691692164606,
        "150": 0.10887703164040362,
        "151": 0.15162934140515505,
        "152": 0.010493960197322412,
        "153": 0.08613353255960747,
        "154": -0.006678491619162229,
        "155": -0.2054525104609671,
        "156": 0.005583416432129785,
        "157": -0.2228411418672489,
        "158": -0.025403798367430765,
        "159": -0.0160359445588971,
        "160": 0.06432710590622549,
        "161": 0.08168298282381511,
        "162": 0.09329800652798749,
        "163": 0.07790538772115806,
        "164": 0.0083131132697444,
        "165": -0.10992710278063919,
        "166": -0.056641415037918745,
        "167": -0.041791662683180276,
        "168": -0.03454554791132283,
        "169": -0.022250663700948792,
        "170": -0.9476064194294368,
        "171": -0.6642298043288273,
        "172": -0.3767433130877418,
        "173": -0.03132029144361004,
        "174": 0.004956220911222555,
        "175": -0.08789660586254085,
        "176": -0.06801550070618569,
        "177": -0.03521338798715809,
        "178": -0.042311324639682076,
        "179": -0.011154496052566671,
        "180": 0.2237150898589406,
        "181": -0.031470861065863096,
        "182": 1.7487384428638912,
        "183": 0.12276496929988115,
        "184": -0.004509172807146733,
        "185": -0.10174168017235358,
        "186": -0.2571223529183358,
        "187": -0.005226571938894662,
        "188": -0.252863261982304,
        "189": 0.006414924914140306,
        "190": -0.04761413885795482,
        "191": -0.06097813068038692,
        "192": -0.07554020305627968,
        "193": -0.05141750518133659,
        "194": 0.0050063621242645035,
        "195": 0.15176878987015666,
        "196": 0.11863998670338372,
        "197": 0.07502837502512397,
        "198": 0.05626618331949824,
        "199": 0.0097379725485323,
        "200": 0.2286138245959152,
        "201": 0.045699575538233256,
        "202": 0.03742782090620353,
        "203": 0.027528880664155084,
        "204": 0.003481337286995719,
        "205": 0.1174003197643581,
        "206": 0.03358288044215678,
        "207": 0.02309196495597747,
        "208": 0.04745031007945702,
        "209": 0.004576380015705842,
        "210": -0.31870767581397424,
        "211": -0.5618382500512024,
        "212": -0.010321830467182772,
        "213": -0.02689370525873188,
        "214": -0.010356129754222227,
        "215": -0.14865636626239614,
        "216": -0.09269110335203576,
        "217": -0.12350703815248641,
        "218": -0.08338555148790587,
        "219": -0.00962553818643684,
        "220": 0.1511779832276137,
        "221": 0.030398888279259677,
        "222": 0.024416871513874467,
        "223": 0.03714545182487917,
        "224": 0.010322643764560935,
        "225": -0.26424897071458714,
        "226": 0.07165298126083881,
        "227": -0.03828932972398249,
        "228": -0.25971768750771135,
        "229": 0.0003701902478404915,
        "230": 0.09840581204797691,
        "231": 0.2188231584251438,
        "232": 0.11275618870929667,
        "233": 0.17715213065807886,
        "234": -0.018161736411663673,
        "235": -0.03708219408556853,
        "236": -0.3081670826338487,
        "237": -0.2439851618557593,
        "238": -0.19404734321708514,
        "239": -0.007389612319532644,
        "240": 0.20611211067556803,
        "241": 3.9247361242966834,
        "242": 3.003301565013002,
        "243": 3.731940203380429,
        "244": -0.005052606854960063,
        "245": 0.08533672133894468,
        "246": 0.06968698587301722,
        "247": 0.07070925725223977,
        "248": 0.06277505118428564,
        "249": 0.0029835047166023652,
        "250": -0.18856952935446097,
        "251": -0.03263123050514825,
        "252": -0.21809593429059937,
        "253": -0.02950016883981225,
        "254": -0.015826441778256758,
        "255": -0.07363673287551674,
        "256": -0.12698563863670492,
        "257": -0.026066773640990477,
        "258": -0.06436053390687894,
        "259": 0.011707764470390887,
        "260": -0.05889464427150089,
        "261": -0.19140470995932962,
        "262": -0.11635467564773802,
        "263": -0.16677203256805773,
        "264": 0.0007744611383921318,
        "265": -0.14322230392105875,
        "266": 0.003567052512059664,
        "267": -0.052328560077663455,
        "268": -0.03753714773756755,
        "269": 0.0004730800774224951,
        "270": -0.1039764379780212,
        "271": -0.17400722372673724,
        "272": -0.2847780228053414,
        "273": -0.1505968873767177,
        "274": 0.009140537338441206,
        "275": 0.06761390326433322,
        "276": 0.022012956527639432,
        "277": 0.2627743113289363,
        "278": 0.11678967906614376,
        "279": 0.022446042162109985,
        "280": -0.0660410916608337,
        "281": -0.048452349216151866,
        "282": -0.07638562054875321,
        "283": -0.04969255880609763,
        "284": -0.008780631088425375,
        "285": 0.3830436801966228,
        "286": 0.03880278107637743,
        "287": 0.1425418066008626,
        "288": -0.013087061913383356,
        "289": -0.006601205670892389,
        "290": -0.2588206228848072,
        "291": -0.7593711304611545,
        "292": -0.44840835738623835,
        "293": -0.3693092310345354,
        "294": -0.008806157069888994,
        "295": -0.13619519641332034,
        "296": -0.02019018291475638,
        "297": -0.036133662351075124,
        "298": -0.0361863310795921,
        "299": -0.008522189428837926,
        "300": 0.29205458948194374,
        "301": 0.21955588074142035,
        "302": 0.08178304684124771,
        "303": 0.19292467915946573,
        "304": -0.01238606466916928,
        "305": -0.4645219537644392,
        "306": 0.0033663040939004548,
        "307": -0.007305961285434787,
        "308": -0.0030681749680475942,
        "309": -0.006180421952536762,
        "310": 0.30584030182073385,
        "311": 0.06290250546001898,
        "312": 0.08634701929570068,
        "313": 0.038119957968808724,
        "314": -0.0006879816204246833,
        "315": 0.05944066755058742,
        "316": 0.17371270717677015,
        "317": 0.07331396470377906,
        "318": 0.10822002464483714,
        "319": 0.005219227803672386,
        "320": 0.2208042333180024,
        "321": 0.05314711159990596,
        "322": 0.08688539925426429,
        "323": 0.01516459657516061,
        "324": -0.0011572502376497767,
        "325": 0.6190813572569298,
        "326": 0.025696288252847053,
        "327": 0.17271624193385876,
        "328": 0.0340279138173017,
        "329": 0.013276970627809838,
        "330": 0.1748356817817148,
        "331": 0.0017086459693091958,
        "332": 0.008959172232257192,
        "333": 0.03755176707675733,
        "334": 0.031582495288021255,
        "335": 0.29698151355392316,
        "336": 0.20799522367932619,
        "337": 0.09390426568995297,
        "338": 0.47566813181448186,
        "339": 0.00872252994643305,
        "340": 0.044097994770905154,
        "341": 0.13335472253873695,
        "342": 0.15803525873292254,
        "343": 0.09364183214939886,
        "344": -0.00055077711447497,
        "345": -0.11670160058805926,
        "346": -0.08238814995731178,
        "347": -0.0018426723056517123,
        "348": -0.11093382665060818,
        "349": -0.00953665022595278,
        "350": -3.110323199375432,
        "351": -0.7575299505604833,
        "352": -2.1679829709788465,
        "353": -0.6240409026895156,
        "354": 0.012526209642750662,
        "355": 0.11167676893276836,
        "356": 0.043833839313811865,
        "357": 0.05308673530850615,
        "358": 0.035959810186005074,
        "359": 0.010293683573116401,
        "360": 0.08499028744798005,
        "361": 0.013460308002738822,
        "362": 0.14565942692812606,
        "363": 0.04226300614372259,
        "364": -0.01360029478904717,
        "365": -0.06112873969315921,
        "366": -0.5004451635476309,
        "367": -0.1817036685497121,
        "368": -0.352974145762558,
        "369": 0.00786374153789675,
        "370": 0.08971927895969195,
        "371": 0.4212388203698987,
        "372": 0.009289959158378602,
        "373": 0.32630613000134906,
        "374": 0.0017260013474048551,
        "375": 0.04206242777622435,
        "376": 0.20704584034352122,
        "377": 0.23888938753420358,
        "378": 0.11351151949439252,
        "379": -0.01275396031646402,
        "380": -0.5384264590955756,
        "381": -0.7912019100392838,
        "382": -0.25532356273342116,
        "383": -1.0266213869467182,
        "384": -0.011687093843326455,
        "385": 0.03200632445680444,
        "386": 1.1303880944462117,
        "387": 1.0897160665105015,
        "388": 0.49478385520772517,
        "389": 0.004244513023528942,
        "390": 0.1374739801668271,
        "391": 0.04021389589289907,
        "392": 0.01655532283362656,
        "393": 0.0341035738427996,
        "394": -0.00369640959359936,
        "395": -0.21498167654324454,
        "396": -0.03412381365727819,
        "397": -0.07053499705863144,
        "398": -0.02252603009677364,
        "399": -0.007482765622238068,
        "400": 0.08735586360056155,
        "401": 0.0055002208344760075,
        "402": 0.15126009888995978,
        "403": 0.3444290443320593,
        "404": -0.001069714515136441,
        "405": 0.965513176144601,
        "406": 0.7701878690472185,
        "407": 1.0549645401722871,
        "408": -0.2019092578100206,
        "409": 0.007345856448460031,
        "410": -1.4933191906218046,
        "411": -0.593546840894454,
        "412": 0.10447942452831603,
        "413": -1.0399512595613318,
        "414": -0.004017365361327329,
        "415": 0.12467437972431959,
        "416": 0.023351725167911872,
        "417": 0.07333324908431178,
        "418": 0.03368845239243897,
        "419": -0.007884325585091464,
        "420": -0.11209677983909061,
        "421": -0.017167710899562857,
        "422": -0.05893428010626388,
        "423": -0.039018025659792975,
        "424": 0.013963323710988735,
        "425": 0.06462824294993248,
        "426": 0.16917284713131564,
        "427": 0.012589430673525784,
        "428": 0.15094676267780455,
        "429": 0.0009227793136668655,
        "430": 0.08879846426834184,
        "431": 0.3481756092683038,
        "432": 0.11211622799913169,
        "433": 0.22909821949506134,
        "434": 0.012238950606364086,
        "435": -0.11620755334572275,
        "436": -0.08054292632605739,
        "437": -0.014457431985111588,
        "438": -0.032594491948881095,
        "439": -0.002296346303557514,
        "440": 0.5448571077327126,
        "441": 0.07202216060230533,
        "442": 0.1641050408985353,
        "443": -0.0402640030931249,
        "444": -0.0032949800432715776,
        "445": -0.6391526280970339,
        "446": -0.319375486365301,
        "447": -0.008529665557662094,
        "448": -0.04171024282059326,
        "449": -0.014605747179426675,
        "450": -0.11197693607093517,
        "451": -0.02535815232433429,
        "452": -0.04152909059865657,
        "453": -0.042293032029075535,
        "454": -0.00004465239770193306,
        "455": 0.15941730523842446,
        "456": 0.06355806239429933,
        "457": -0.000676723542713032,
        "458": 0.05370833060927052,
        "459": 0.004377113570354314,
        "460": -0.3577455131317179,
        "461": -0.013271191421468804,
        "462": -0.009306088597418029,
        "463": 0.01017556252294353,
        "464": -0.009311272762646372,
        "465": -0.18923301406945225,
        "466": -0.05537810209070213,
        "467": -0.028082305177098272,
        "468": 0.003338957465402083,
        "469": 0.006108217960908183,
        "470": 0.07651647420651488,
        "471": 0.11714807971953571,
        "472": 0.028120637056191614,
        "473": 0.07629575850516544,
        "474": -0.009272088111599032,
        "475": -0.03467439730394888,
        "476": -1.1858148131515127,
        "477": -0.8404129300934579,
        "478": -1.2555013923701035,
        "479": 0.007869061918540726,
        "480": -0.05688482418784498,
        "481": -0.17479329838902005,
        "482": -0.14791035726976362,
        "483": -0.18034625460920004,
        "484": -0.009817872934282119,
        "485": 0.18664314341627752,
        "486": 0.03535036592077985,
        "487": 0.6551235886721255,
        "488": 0.3020706205700778,
        "489": 0.011135997245548823,
        "490": -0.4557774157668387,
        "491": 0.0014236312648096517,
        "492": -0.018232945164773695,
        "493": -0.000860469694161086,
        "494": -0.007695717427057375,
        "495": 0.4230805115484677,
        "496": 0.06349286362213288,
        "497": 0.15203245846681798,
        "498": 0.01731702481402323,
        "499": -0.005223777843415494
      }
    },
    "b1": {
      "n": 100,
      "d": 1,
      "w": {
        "0": 0.0002445665474891307,
        "1": -0.0020073571592989004,
        "2": -0.0008516653106830518,
        "3": 0.006719475662242954,
        "4": 0.00038699767883244407,
        "5": 0.00009368576773906921,
        "6": -0.0008016220237038931,
        "7": -0.0007773208214658309,
        "8": 0.004300741640620096,
        "9": -0.0007090711407628958,
        "10": 0.0024875111739548453,
        "11": -0.0014973334115361066,
        "12": 0.0017595081010775163,
        "13": -0.0008104271396723342,
        "14": 0.0005914918051850591,
        "15": 0.002674986668161075,
        "16": 0.0004885970457205537,
        "17": 0.0004521464477945685,
        "18": -0.00034294608180295065,
        "19": 0.0005935955733165334,
        "20": 0.00023009715039354437,
        "21": -0.0002897513399500581,
        "22": 0.008555162866726815,
        "23": 0.0014385840374576632,
        "24": 0.0005957229354283337,
        "25": 0.013975626934770105,
        "26": -0.0021528584303767734,
        "27": -0.0006031658396324406,
        "28": 0.005297326462206289,
        "29": -0.0022745383121772944,
        "30": 0.00029194380717741586,
        "31": -0.0008696728305342667,
        "32": 0.0016682256428857413,
        "33": -0.0014783345438663077,
        "34": 0.006027114587987581,
        "35": -0.00016897647326434909,
        "36": 0.004055365471226992,
        "37": 0.004425290574907791,
        "38": -0.0009939790541864614,
        "39": 0.0017790934678827157,
        "40": 0.00008415681587762845,
        "41": 0.00015642999667789012,
        "42": 0.00371171313579166,
        "43": -0.00032979557490045284,
        "44": 0.0003990924688216293,
        "45": -0.007848481334638356,
        "46": 0.0009258546823909319,
        "47": -0.001332143441572115,
        "48": 0.015738528944394842,
        "49": 0.00023691963629967442,
        "50": -0.00022173660848334722,
        "51": -0.0018499606441218668,
        "52": -0.0005128985862625813,
        "53": -0.00026698890208287,
        "54": -0.0010655164982497532,
        "55": 0.0011658852687529417,
        "56": -0.0008843628588343556,
        "57": 0.0005233989572059936,
        "58": -0.0005660709293485554,
        "59": -0.0005549086652889856,
        "60": 0.0010300330762028364,
        "61": -0.0015801322494360518,
        "62": 0.0004547634758080252,
        "63": 0.001392816664260425,
        "64": 0.0003484215107887825,
        "65": 0.0006002011872254143,
        "66": 0.00034782109099547754,
        "67": 0.009028771460751017,
        "68": 0.00047255023448069855,
        "69": -0.00028166415015380334,
        "70": -0.00626669217971304,
        "71": 0.0005272386903186467,
        "72": 0.0009564510523226493,
        "73": -0.0017854821276549276,
        "74": 0.00012963638476955246,
        "75": 0.0016519630469953306,
        "76": -0.01054709261973396,
        "77": 0.006650552534418582,
        "78": 0.000283950984666989,
        "79": -0.00037912718419388735,
        "80": 0.004844389401376829,
        "81": -0.01037229726351624,
        "82": -0.0065661486739165865,
        "83": 0.0005187295068144889,
        "84": -0.0008038851679786657,
        "85": 0.000740181470093475,
        "86": 0.0009261805244453251,
        "87": 0.00013872322148704848,
        "88": 0.0002676291355437918,
        "89": 0.002328967923139705,
        "90": -0.00019516733496983526,
        "91": -0.0005440504853801956,
        "92": -0.001787635089487705,
        "93": 0.00011407491354223487,
        "94": 0.0007488308915237776,
        "95": -0.014734561640878416,
        "96": -0.0016919164738205138,
        "97": 0.005104437256574769,
        "98": 0.0000579244582454726,
        "99": 0.001496148213272248
      }
    },
    "W2": {
      "n": 2,
      "d": 100,
      "w": {
        "0": 0.0025087408114966986,
        "1": 0.1030378070024226,
        "2": 0.05729776162287323,
        "3": -0.17641793018850244,
        "4": -0.13761198243082662,
        "5": -0.013698486425172345,
        "6": 0.04064327597460553,
        "7": 0.034394147635300354,
        "8": 0.016047320870290767,
        "9": -0.022869617031867906,
        "10": -0.10251477998312492,
        "11": -0.0019602017827222654,
        "12": 0.6025328670935539,
        "13": -0.631405454389391,
        "14": -0.0828286659400374,
        "15": -0.022212327571961316,
        "16": 0.002097252203106429,
        "17": 0.004987879766921022,
        "18": 0.03406043572680105,
        "19": 0.013141764089637723,
        "20": -0.008438445040481973,
        "21": -0.01786694769404218,
        "22": 0.2007746212212333,
        "23": -0.08552185070168183,
        "24": 0.6036785825275595,
        "25": -0.043521981759605075,
        "26": 0.07492707497249929,
        "27": 0.011340491818742651,
        "28": -0.12924192737283202,
        "29": 0.06531520718300819,
        "30": -0.006415859550627063,
        "31": 0.0019686262301698123,
        "32": -0.06908174520397839,
        "33": -0.010379783792905772,
        "34": 0.7447475260726544,
        "35": 0.03426745682645502,
        "36": -0.14262218251735298,
        "37": 0.05642254686412315,
        "38": 0.02055290041667025,
        "39": -0.004888244590406584,
        "40": 0.020934661105591758,
        "41": 0.00952133763079618,
        "42": 0.17256127473955907,
        "43": -0.025463881956481478,
        "44": -0.0005704664559439608,
        "45": -0.24422494430569708,
        "46": -0.056452082300443046,
        "47": 0.08829573120960874,
        "48": 2.659758248226392,
        "49": -0.009724189698425097,
        "50": -0.00928136131748447,
        "51": 0.07408003280358313,
        "52": 0.11382937243920721,
        "53": 0.001769805023412176,
        "54": 0.1301237190079959,
        "55": -0.10703817699208582,
        "56": 0.0021311204854508083,
        "57": 0.01988044202475696,
        "58": 0.5614131387624841,
        "59": -0.0014304308609519125,
        "60": -0.096761168604479,
        "61": -0.03183374464336837,
        "62": -0.009773578560849476,
        "63": -0.06552775845930826,
        "64": 0.00989421059107756,
        "65": 0.06979423524628128,
        "66": 0.03017632898876462,
        "67": 0.49983308993374115,
        "68": -0.03663569491957702,
        "69": -0.006603442933204061,
        "70": -0.43350729790396325,
        "71": -0.022556011124721005,
        "72": 0.008715932365284116,
        "73": -0.05231780488242528,
        "74": -0.0976176005377398,
        "75": -0.05021326157769031,
        "76": -0.06257347564644433,
        "77": 0.01747095859184783,
        "78": -0.01601925583674249,
        "79": -0.024204668463152598,
        "80": 0.25018529375830667,
        "81": -0.5965208061362564,
        "82": -0.7198963050961185,
        "83": -0.014105170282862714,
        "84": 0.008527810465207186,
        "85": -0.03332087623367824,
        "86": -0.031309761124555475,
        "87": 0.03088506764489073,
        "88": -0.010383535719989408,
        "89": 0.11213387531274999,
        "90": -0.0012501536913346115,
        "91": 0.005958237584421134,
        "92": -0.06892070007536491,
        "93": 0.0670504645291582,
        "94": -0.08433661445013493,
        "95": 0.08196669143130228,
        "96": 0.10418308176575775,
        "97": 1.319678584359362,
        "98": -0.029683348164649924,
        "99": -0.15187991269431617,
        "100": 0.08514601285831347,
        "101": 0.10062394369950073,
        "102": 0.03893604026480021,
        "103": -0.17426514873297014,
        "104": -0.14885987210880178,
        "105": -0.05793961537402425,
        "106": 0.020932589625107315,
        "107": -0.01306374539554299,
        "108": 0.02201238104334217,
        "109": -0.10627934746935648,
        "110": -1.202251707799537,
        "111": -0.03594901876382712,
        "112": 0.5593715219084873,
        "113": -1.3267323388846528,
        "114": -0.05212116390884488,
        "115": 0.45983273100871647,
        "116": -0.06947971374953232,
        "117": 0.09577442856925182,
        "118": 0.10115574064904599,
        "119": 0.08244701929360139,
        "120": -0.08907218163153086,
        "121": -0.07354688215266975,
        "122": 0.314434839860546,
        "123": -0.021135317934952352,
        "124": 0.6615053224120094,
        "125": -0.04109410458235325,
        "126": 0.04494645956210564,
        "127": -0.06922767966093202,
        "128": -0.06208986864166812,
        "129": 0.044500942075696846,
        "130": 0.05509653408902097,
        "131": -0.03213654119808809,
        "132": 0.026797845025971906,
        "133": 0.07783037973160342,
        "134": 0.39141124987438636,
        "135": -0.06315174011154778,
        "136": -0.14429401628740982,
        "137": 0.0593280863454125,
        "138": -0.040899203257081476,
        "139": 0.05581180800750999,
        "140": 0.10547142777274005,
        "141": 0.08992514390643847,
        "142": 1.322981361697312,
        "143": -0.08700176329901035,
        "144": 0.09329116356887672,
        "145": -0.1069896318506018,
        "146": -0.026136727274711134,
        "147": 0.04616863794982964,
        "148": -0.027486032721906743,
        "149": 0.019904300020262024,
        "150": -0.05210480513701251,
        "151": 0.014573851168049793,
        "152": 0.09115853958746009,
        "153": -0.08079166015024931,
        "154": 0.008223164954929195,
        "155": -0.025812657566911805,
        "156": -0.07521457619190262,
        "157": 0.08103808850373238,
        "158": 0.19077584178709875,
        "159": -0.08571553449719353,
        "160": -0.15101794863770326,
        "161": -0.08243365696598885,
        "162": 0.07371901616323674,
        "163": 0.009026448851906404,
        "164": 0.08211029308203481,
        "165": 0.12041588035488834,
        "166": 0.08883144601362776,
        "167": 0.2151341251442266,
        "168": 0.09033479746191614,
        "169": -0.03559858191533501,
        "170": -0.7337834191048376,
        "171": 0.06769959751173965,
        "172": 0.0769704073714375,
        "173": -0.08485114468885666,
        "174": -0.09504251459023888,
        "175": -0.01992048209658897,
        "176": -3.3191695892938515,
        "177": 0.0601735618167013,
        "178": 0.04825194376102881,
        "179": -0.0812308676633994,
        "180": 0.30933798741165797,
        "181": -0.6561671264840625,
        "182": -0.0404103982872887,
        "183": 0.07094438341532125,
        "184": -0.07661536467262789,
        "185": 0.012513077380703294,
        "186": 0.006921957519362532,
        "187": -0.05419710435390681,
        "188": 0.06392872974793154,
        "189": 0.383809145826567,
        "190": -0.07532927720184708,
        "191": 0.07027102914800469,
        "192": -0.1293834611288305,
        "193": -0.02159559254094766,
        "194": -0.031252231056694176,
        "195": 0.13787534052076442,
        "196": 0.04758721876256688,
        "197": 0.2672585798127429,
        "198": -0.11371125817429806,
        "199": -0.026481498713188133
      }
    },
    "b2": {
      "n": 2,
      "d": 1,
      "w": {
        "0": 0.005682504559775161,
        "1": 0.08370296981004324
      }
    }
  }
}